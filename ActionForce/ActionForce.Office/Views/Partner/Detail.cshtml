@model PartnerControlModel
@{
    ViewBag.Title = "Partner";
}

@section style{
    <link rel="stylesheet" href="/assets/css/dashforge.profile.css">
}

<div class="content-header">
    <div class="content-search">
        <span class="tx-20">İşortağı Detayı</span>
    </div>
    <nav class="nav">
        @(DateTime.UtcNow.AddHours(Model.Authentication.ActionEmployee.OurCompany.TimeZone.Value).ToLongDateString())
    </nav>
</div>
<div class="content-body">
    <div class="pd-x-0 tx-13">
        <div class="media d-block d-lg-flex">
            <div class="media-body  mg-t-40 mg-lg-t-0">
                <div class="d-sm-flex align-items-center justify-content-between mg-b-20 mg-lg-b-25 mg-xl-b-30">
                    <div>
                        <h4 class="mg-b-0 tx-spacing--1">@(Model.VPartner?.FullName)</h4>
                    </div>
                    <div class="d-none d-md-block">

                        <a href="/Partner/Index" class="btn btn-primary btn-uppercase"><i data-feather="list"></i> &nbsp; İşortakları Listesi</a> &nbsp;
                        <a href="/Partner/NewPartner" class="btn btn-success btn-uppercase">Yeni İşortağı</a>

                    </div>
                </div>
                @using (Html.BeginForm("EditPartner", "Partner", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    <div class="row row-xs">
                        <div class="col-lg-12">
                            <input id="PartnerID" name="PartnerID" type="hidden" value="@(Model.VPartner.ID)" />
                            <input id="PartnerUID" name="UID" type="hidden" value="@(Model.VPartner.UID)" />
                            <div class="form-group row mg-b-5 bg-gray-100">
                                <label for="AccountCode" class="col-sm-3 col-form-label">İşortağı No</label>
                                <div class="col-sm-6">
                                    <input id="AccountCode" name="AccountCode" autocomplete="off" type="text" class="form-control tx-16 text-danger" placeholder="İşortağı No" value="@(Model.VPartner.AccountCode)" required>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row mg-b-5 bg-gray-100">
                                <label for="FullName" class="col-sm-3 col-form-label">Adı Soyadı / Ünvanı</label>
                                <div class="col-sm-6">
                                    <input id="FullName" name="FullName" autocomplete="off" type="text" class="form-control tx-16" placeholder="Adı Soyadı / Ünvanı" value="@(Model.VPartner.FullName)" required>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row mg-b-5">
                                <label for="TaxOffice" class="col-sm-3 col-form-label">Vergi Dairesi</label>
                                <div class="col-sm-6">
                                    <input id="TaxOffice" name="TaxOffice" autocomplete="off" type="text" class="form-control" placeholder="Vergi Dairesi" value="@(Model.VPartner.TaxOffice)">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row">
                                <label for="TaxNumber" class="col-sm-3 col-form-label">Vergi Numarası</label>
                                <div class="col-sm-6">
                                    <input id="TaxNumber" name="TaxNumber" autocomplete="off" type="text" class="form-control" placeholder="Vergi Numarası" value="@(Model.VPartner.TaxNumber)">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row">
                                <label for="EMail" class="col-sm-3 col-form-label">Email Adresi</label>
                                <div class="col-sm-6">
                                    <input id="EMail" name="EMail" autocomplete="off" type="text" class="form-control" placeholder="Email Adresi" value="@(Model.VPartner.EMail)">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row">
                                <label for="Phone" class="col-sm-3 col-form-label">Telefon</label>
                                <div class="col-sm-2">
                                    <input id="PhoneCode" name="PhoneCode" autocomplete="off" type="text" class="form-control" placeholder="+90" value="@(Model.VPartner.PhoneCode)">
                                </div>
                                <div class="col-sm-4">
                                    <input id="Phone" name="Phone" autocomplete="off" type="text" class="form-control" placeholder="5555555555" value="@(Model.VPartner.Phone)">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row">
                                <label for="Address" class="col-sm-3 col-form-label">Adres</label>
                                <div class="col-sm-6">
                                    <textarea id="Address" name="Address" rows="2" cols="20" class="form-control" style="width:100% !important;">@(Model.VPartner.Address)</textarea>
                                </div>
                                <div class="col-sm-3">
                                </div>
                            </div>






                            <div class="form-group row mg-b-5">
                                <label for="Country" class="col-sm-3 col-form-label">Ülke</label>
                                <div class="col-sm-6">
                                    <select class="form-control" id="Country" name="Country">
                                        <option value="">Ülke Seçiminiz</option>
                                        @foreach (var item in Model.Countries)
                                        {
                                            <option value="@item.ID" @(item.ID == Model.VPartner.Country ? "selected" : "")>@(item.CountryName)</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-sm-3"> </div>
                            </div>

                            <div class="form-group row mg-b-5">
                                <label for="State" class="col-sm-3 col-form-label">Eyalet</label>
                                <div class="col-sm-6">
                                    <select class="form-control" id="State" name="StateID">
                                        <option value="">Eyalet Seçiminiz</option>
                                        @foreach (var item in Model.States)
                                        {
                                            <option value="@item.ID" @(item.ID == Model.VPartner.State ? "selected" : "")>@(item.StateName)</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-sm-3"> </div>
                            </div>

                            <div class="form-group row mg-b-5">
                                <label for="City" class="col-sm-3 col-form-label">Şehir</label>
                                <div class="col-sm-6">
                                    <select class="form-control" id="City" name="CityID">
                                        <option value="">Şehir Seçiminiz</option>
                                        @foreach (var item in Model.Cities.OrderBy(x => x.CityName))
                                        {
                                            <option value="@item.ID" @(item.ID == Model.VPartner.City ? "selected" : "")>@(item.CityName)</option>
                                        }
                                    </select>
                                </div>
                                <div class="col-sm-3"> </div>
                            </div>


                            <div class="form-group row">
                                <label for="PostCode" class="col-sm-3 col-form-label">Posta Kodu</label>
                                <div class="col-sm-6">
                                    <input id="PostCode" name="PostCode" autocomplete="off" type="text" class="form-control" placeholder="Posta Kodu" value="@(Model.VPartner.PostCode)">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>

                            <div class="form-group row mg-b-0">
                                <label for="IsActive" class="col-sm-3 col-form-label">Aktif mi?</label>
                                <div class="col-sm-2">
                                    <div class="custom-control custom-checkbox">
                                        <input type="checkbox" class="custom-control-input" id="IsActive" name="IsActive" value="1" @(Model.VPartner.IsActive == true ? "checked" : "")>
                                        <label class="custom-control-label" for="IsActive">Aktif</label>
                                    </div>
                                </div>
                                <div class="col-sm-3">
                                </div>
                            </div>


                            <div class="form-group row mg-b-0">
                                <div class="col-sm-3">

                                </div>
                                <div class="col-sm-6">
                                    <button type="submit" class="btn btn-primary btn-block">İşortağı Bilgilerini Güncelle</button>
                                </div>
                                <div class="col-sm-3">
                                </div>
                            </div>

                        </div>
                    </div>
                }

                <div class="row no-gutters mt-5 d-flex align-items-center justify-content-between">

                    <div class="col-md-6">
                        <h4>Ortaklık Pay Listesi</h4>
                    </div>
                    <div class="col-md-6">
                        @using (Html.BeginForm("PrePartnership", "Partner", FormMethod.Post))
                        {
                            @Html.AntiForgeryToken()
                            <div class="form-row align-items-end">

                                <div class="form-group col-md-9 d-flex align-items-end ">
                                    <select class="form-control select2 mb-0" id="LocationID" name="LocationID">
                                        <option value="" label="Lokasyon Seçiminiz"></option>
                                        @foreach (var item in Model.Locations.OrderBy(x => x.SortBy))
                                        {
                                            <option value="@item.LocationID">@(Html.Raw($"<strong>{item.LocationFullName}</strong>"))</option>
                                        }
                                    </select>
                                </div>

                                <div class="form-group col-md-3 d-flex align-items-end ">
                                    <input id="PartnerID2" name="PartnerID" type="hidden" value="@(Model.VPartner.ID)" />
                                    <input id="PartnerUID2" name="PartnerUID" type="hidden" value="@(Model.VPartner.UID)" />
                                    <button class="btn btn-primary btn-block mb-0" type="submit" id="btnsearch">Yeni Ortaklık Payı Ekle</button>
                                </div>

                            </div>
                        }
                        @*<a href="/Partner/AddPartnership" class="btn btn-primary btn-sm tx-14 mb-1"> Yeni Ortaklık Payı Ekle </a>*@

                    </div>



                    <div class="col-md-12 mg-t-0 pd-r-0 pd-l-0 pd-t-0">
                        <div class="table-responsive" id="LocationList">
                            <table class="table table-primary table-hover table-striped mg-b-0">
                                <thead>
                                    <tr class="table-active">
                                        <th>#</th>
                                        <th scope="col">Lokasyon</th>
                                        <th scope="col">Oran</th>
                                        <th scope="col">Başlangıç</th>
                                        <th scope="col">Bitiş</th>
                                        <th scope="col">Aktif</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.Partnerships)
                                    {
                                        <tr>
                                            <td>@(item.ID)</td>
                                            <td>@(item.LocationFullName)</td>
                                            <td>@(item.PartnershipRate)</td>
                                            <td>@(item.DateStart?.ToString("d"))</td>
                                            <td>@(item.DateEnd?.ToString("d"))</td>
                                            <td>@(item.IsActive)</td>
                                            <td style="width:100px;">
                                                @using (Html.BeginForm("PrePartnership", "Partner", FormMethod.Post))
                                                {
                                                    @Html.AntiForgeryToken()
                                                    <input name="LocationID" type="hidden" value="@(item.LocationID)" />
                                                    <input name="PartnerID" type="hidden" value="@(item.PartnerID)" />
                                                    <button class="btn btn-primary btn-block mb-0 btn-sm" type="submit" id="btnsearch">Detay</button>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>

                </div>

                <div class="row no-gutters mt-5 d-flex align-items-center justify-content-between">
                    <h4>Kullanıcı Listesi</h4>

                    <div class="d-flex">
                        <a href="/Partner/NewPartnerUser/@(Model.VPartner.UID)" class="btn btn-primary btn-sm tx-14 mb-1"> Yeni Kullanıcı Ekle </a>
                    </div>


                    <div class="col-md-12 mg-t-0 pd-r-0 pd-l-0 pd-t-0">
                        <div class="table-responsive" id="LocationList">
                            <table class="table table-primary table-hover table-striped mg-b-0">
                                <thead>
                                    <tr class="table-active">
                                        <th>#</th>
                                        <th scope="col">Adı Soyadı</th>
                                        <th scope="col">Kullanıcı Adı</th>
                                        <th scope="col">Şifre</th>
                                        <th scope="col">Email</th>
                                        <th scope="col">Aktif</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var item in Model.PartnerUsers)
                                    {
                                        <tr>
                                            <td>@(item.ID)</td>
                                            <td>@(item.UserFullname)</td>
                                            <td>@(item.Username)</td>
                                            <td>@(!string.IsNullOrEmpty(item.Password) ? "***":"")</td>
                                            <td>@(item.Email)</td>
                                            <td>@(item.IsActive)</td>
                                            <td style="width:100px;">
                                                <a href="/Partner/DetailPartnerUser/@(item.UID)" class="btn btn-primary btn-sm tx-14 mb-1"> Detay </a>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>

                    </div>

                </div>

            </div>
        </div>
    </div>
</div>


@section scripts {
    <script>
        $(function () {
            'use strict'

            $('#LocationID').select2({
                placeholder: 'Lokasyon Seçiminiz',
                searchInputPlaceholder: 'Search options',
                allowClear: true
            });

        });


        $(document).ready(function () {

            $("#Country").change(function () {

                var countryID = $("#Country").val();

                $.ajax
                    ({
                        url: '/Partner/GetStateList',
                        type: 'POST',
                        datatype: 'application/json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            countryid: countryID
                        }),
                        success: function (data) {

                            $("#City").empty();
                            $("#City").append($('<option></option>', { "value": '', "text": 'Şehir Seçiminiz' }));

                            $("#State").empty();
                            $("#State").append($('<option></option>', { "value": '', "text": 'Eyalet Seçiminiz' }));

                            $.each(data, function (index, label) {
                                $("#State").append($('<option></option>', { "value": label.Value, "text": label.Text }));
                            });
                        },
                        error: function () {
                        },
                    });
            });



            $("#State").change(function () {

                var stateID = $("#State").val();

                $.ajax
                    ({
                        url: '/Partner/GetCityList',
                        type: 'POST',
                        datatype: 'application/json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            stateid: stateID
                        }),
                        success: function (data) {

                            $("#City").empty();

                            $("#City").append($('<option></option>', { "value": '', "text": 'Şehir Seçiminiz' }));

                            $.each(data, function (index, label) {
                                $("#City").append($('<option></option>', { "value": label.Value, "text": label.Text }));
                            });
                        },
                        error: function () {
                        },
                    });
            });


        });


    </script>

    @if (Model.Result != null) //
    {
        <script type="text/javascript">
        $.toast({
            heading: 'Information',
            text: '@Model.Result.Message ',
            showHideTransition: 'slide',
            icon: 'info',
            hideAfter: 5000,
            position: 'bottom-right',
        });
        </script>
    }
}



