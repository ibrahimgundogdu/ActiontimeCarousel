@model SalesControlModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UFE POS</title>
    <meta name="description" content="UFE POS">
    <meta name="keywords" content="UFE POS">
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <link rel="stylesheet" href="/assets/scss/global.css">
</head>
<body>
    <div class="main">
        <div class="container">
            <div class="header">
                <div class="menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="49.778" viewBox="0 0 64 49.778">
                        <path d="M59.889,40.556v7.111H10.111V40.556H59.889M67,5H3v7.111H67Zm0,14.222H3v7.111H67Zm0,14.222H3V54.778H67Z" transform="translate(-3 -5)" fill="currentColor" />
                    </svg>
                    <!-- menu -->
                </div>
                <div class="logo">
                    <a href="javascript:;">UFE POS</a>
                    <div class="date">@(DateTime.Now.ToLongDateString())</div>
                </div>
                <div class="homepage">
                    <a href="@(Model.Authentication.IsCardSystem == true ? "/Card":"/")">
                        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 50 50">
                            <path d="M4,16.5H16.5V4H4ZM22.75,54h12.5V41.5H22.75ZM4,54H16.5V41.5H4ZM4,35.25H16.5V22.75H4Zm18.75,0h12.5V22.75H22.75ZM41.5,4V16.5H54V4ZM22.75,16.5h12.5V4H22.75ZM41.5,35.25H54V22.75H41.5ZM41.5,54H54V41.5H41.5Z" transform="translate(-4 -4)" fill="currentColor" />
                        </svg>
                        <!-- homepage -->
                    </a>
                </div>
            </div><!-- header -->
            <div class="side-menu-overlay"></div>
            <div class="side-menu">
                @{ Html.RenderPartial("_PartialMenu");}
            </div><!-- side-menu -->
            <div class="content">
                <div class="order-detail">

                    <h1>SİPARİŞ GENEL BİLGİSİ</h1>
                    <ul>
                        <li><span>ID</span><span> @(Model.TicketSale.ID)</span></li>
                        <li><span>SİPARİŞ NO</span><span> @(Model.TicketSale.OrderNumber)</span></li>
                        <li><span>SİPARİŞ TARİHİ</span><span> @(Model.TicketSale.Date?.ToShortDateString())</span></li>
                        <li><span>DURUM</span><span>@(Model.TicketSale.PosStatusID == 5 ? $"%{Model.RefundRate.ToString("N0")}":"") @(Model.TicketSalePosStatus.FirstOrDefault(x=> x.ID == Model.TicketSale.PosStatusID)?.PosStatusName)</span></li>
                        <li><span>TUTAR</span><span>@(Model.TicketSaleSummary.Total.ToString("N2")) @(Model.TicketSaleSummary.Sign)</span></li>
                        <li><span>TAHSİLAT</span><span>@((Model.TicketSaleSummary.PaymentAmount).ToString("N2")) @(Model.TicketSaleSummary.Sign)</span></li>
                        <li><span>İADE</span><span>@((Model.TicketSaleSummary.RefundAmount).ToString("N2")) @(Model.TicketSaleSummary.Sign)</span></li>
                        <li><span>BİLET ADEDİ</span><span>@(Model.TicketSaleSummary.Quantity)</span></li>
                        <li><span>ORTAM BİLGİSİ</span><span>@(Model.Environments.FirstOrDefault(x=> x.ID == Model.TicketSaleSummary.EnvironmentID)?.Environment1)</span></li>
                        <li><span>KAYIT TARİHİ</span><span> @(Model.TicketSaleSummary.RecordDate.ToString())</span></li>
                        <li><span>SONLANMA</span><span> @(Model.TicketSaleSummary.IsSendPosTerminal == true ? "Ingenico":"Manuel")</span></li>
                        <li><span>KAYDEDEN</span><span>@(Model.TicketSaleSummary.FullName)</span></li>
                        <li>
                            <span>CARİ KAYIT</span>
                            <span>
                                @if (Model.TicketSale.PosStatusID == 3)
                                {
                                    if (Model.DocumentActions.Count > 0)
                                    {
                                        @(Model.DocumentNumbers.ToString());
                                    }
                                    else
                                    {
                                        <a href="/Sales/CheckDocument/@(Model.TicketSale.ID)">EKLE</a>
                                    }
                                }
                                else
                                {
                                    if (Model.DocumentActions.Count > 0)
                                    {
                                        @(Model.DocumentNumbers.ToString());
                                    }
                                }

                            </span>
                        </li>
                        <li>
                            <span>ÖDEME TAMAMLA</span>
                            <span>
                                @if ((Model.TicketSaleSummary.BalanceAmount) > 0)
                                {
                                    <a href="/Sales/Payment/@(Model.TicketSale.ID)" class="btn btn-success">TAMAMLA</a>
                                }
                                else
                                {
                                    <a href="/Sales/Payment/@(Model.TicketSale.ID)" class="btn btn-info">Kalan: @(Model.TicketSaleSummary.BalanceAmount.ToString("N2")) ₺</a>
                                }


                            </span>
                        </li>
                        <li>
                            <span>SİPARİŞ SİLME</span>
                            <span>
                                @if (Model.TicketSale.PosStatusID == 0)
                                {
                                    <a href="/Sales/Remove/@(Model.TicketSale.ID)" class="btn btn-danger" onclick="return confirm('Silmek istediğinize emin misiniz?')">SİL</a>
                                }
                                else
                                {
                                    <a href="javascript:;" class="btn btn-danger">Silinemez: @(Model.TicketSalePosStatus.FirstOrDefault(x=> x.ID == Model.TicketSale.PosStatusID)?.PosStatusName)</a>
                                }


                            </span>
                        </li>
                    </ul>

                    <h1>SİPARİŞ DETAYI</h1>
                    <div class="table-responsive">
                        <table>
                            <tr>
                                <th>ÜRÜN</th>
                                <th>DURUM</th>
                                <th>KDV %</th>
                                <th>DK</th>
                                <th>FİYAT</th>
                            </tr>
                            @foreach (var item in Model.TicketSaleRows)
                            {
                                <tr>
                                    <td><a href="/Sales/RowDetail/@(item.ID)?OrderID=@(Model.TicketSale.ID)" class="btn btn-light" style="font-weight:500; color:darkblue;">@(item.ProductName)</a></td>
                                    <td>@(item.StatusName)</td>
                                    <td>@(item.TaxRate) %</td>
                                    <td>@(item.SaleRowUnit) dk @(item.ExtraUnit > 0 ? $" + {item.ExtraUnit} dk, {item.ExtraPrice?.ToString("N2")} {item.Sign}":"")</td>
                                    <td><a href="/Sales/RowDetail/@(item.ID)?OrderID=@(Model.TicketSale.ID)" class="btn btn-light" style="font-weight:500; color:darkblue;">@(item.RowTotal?.ToString("N2")) @(item.Sign)</a></td>
                                </tr>
                            }
                        </table>
                    </div>

                    <h1>TAHSİLAT DETAYI</h1>
                    <div class="table-responsive">
                        <table>
                            <tr>
                                <th>TÜRÜ</th>
                                <th>TUTAR</th>
                                <th>TAKSİT</th>
                                <th>BANKA</th>
                                <th>NEREDEN</th>
                            </tr>
                            @foreach (var item in Model.TicketSalePosPaymentSummary)
                            {
                                <tr>
                                    <td>@(item.PaymentTypeName.ToUpper())</td>
                                    <td>@(item.PaymentAmount?.ToString("N2")) @(item.Sign)</td>
                                    <td>@(item.PaymentType == 4 ? item.NumberOfInstallment.ToString() : "")</td>
                                    <td>@(item.BankName)</td>
                                    <td>@(item.FromPosTerminal == true ? "Ingenico":"Manuel")</td>
                                </tr>
                            }


                        </table>
                    </div>

                    <h1>İADE DETAYI</h1>
                    <div class="table-responsive">
                        <table class="table table-dashboard table-striped table-hover">
                            <tr>
                                <th>EVRAK NO</th>
                                <th>TARİH</th>
                                <th style="text-align:right;">TUTAR</th>
                                <th style="text-align:left;">TÜR</th>
                                <th>AÇIKLAMA</th>
                                <th>KAYIT</th>
                                <th></th>
                                <th></th>
                            </tr>
                            @foreach (var item in Model.ExpenseSlips)
                            {
                                <tr>
                                    <td style="font-weight:500;"><a href="/Sales/RefundDetail/@(item.ID)" class="btn btn-light" style="font-weight: 500; color: darkblue !important;">@(item.DocumentNumber)</a></td>
                                    <td>@(item.DocumentDate?.ToShortDateString())</td>
                                    <td style="font-weight:500; text-align:right;">@(item.Amount?.ToString("N2")) @(item.Sign)</td>
                                    <td style="text-align:left;">@(item.PayMethodName)</td>
                                    <td>@(item.Description)</td>
                                    <td style="text-align:right;"><a href="/Sales/RefundDetail/@(item.ID)" class="btn btn-light" style="font-weight:500; color:darkblue !important;">@(item.RecordDate)</a></td>
                                    <td style="text-align:right;"><a href="/Sales/RemoveRefund/@(item.ID)" class="btn btn-light" style="font-weight:500; color:darkred !important;">SİL</a></td>
                                    <td style="text-align:right;"><a href="/Sales/CheckRefund/@(item.ID)?oid=@(Model.TicketSaleSummary.ID)" class="btn btn-light" style="font-weight:500; color:darkred !important;">KONTROL</a></td>

                                </tr>
                            }
                        </table>

                    </div>
                    @if (Model.CreditLoads != null && Model.CreditLoads.Count > 0)
                    {
                        <h1>KONTÖR YÜKLEME DETAYI</h1>
                        <div class="table-responsive">
                            <table class="table table-dashboard table-striped table-hover">
                                <tr>
                                    <th>İŞLEM</th>
                                    <th>SERI</th>
                                    <th>MAC</th>
                                    <th>CARD</th>
                                    <th style="text-align:right;">FKREDİ</th>
                                    <th style="text-align:right;">SKREDİ</th>
                                    <th style="text-align:right;">KREDİ</th>
                                    <th>AÇIKLAMA</th>
                                    <th>ZAMAN</th>
                                    <th>DURUM</th>
                                </tr>
                                @foreach (var item in Model.CreditLoads)
                                {
                                    var cardActionType = Model.CardActionTypes.FirstOrDefault(x => x.ID == item.CardActionTypeID);
                                    <tr>
                                        <td style="font-weight:500;"><a href="@(item.CardActionTypeID == 3 ? $"/CardAction/Index/{item.SaleID}":$"/CardAction/CreditRefund/{item.SaleID}")" class="btn btn-light" style="font-weight: 500; color: darkblue !important;">@(cardActionType.NameTR)</a></td>
                                        <td>@(item.SerialNumber)</td>
                                        <td>@(item.MACAddress)</td>
                                        <td>@(item.CardNumber)</td>
                                        <td style="font-weight:500; text-align:right;">@(item.ExistsCredit)</td>
                                        <td style="font-weight:500; text-align:right;">@(item.TotalCredit)</td>
                                        <td style="font-weight:500; text-align:right;">@(item.FinalCredit)</td>
                                        <td style="text-align:left;">@(item.Message)</td>
                                        <td>@(item.RecordDate)</td>
                                        <td style="font-weight:500;"><a href="@(item.CardActionTypeID == 3 ? $"/CardAction/Index/{item.SaleID}":$"/CardAction/CreditRefund/{item.SaleID}")" class="btn btn-light" style="font-weight: 500; color: darkblue !important;">@(item.IsSuccess == true ? "Tamamlandı" : "Bekliyor")</a></td>
                                    </tr>
                                }
                            </table>

                        </div>
                    }
                    else if (Model.Authentication.IsCardSystem == true && Model.TicketSale.PosStatusID == 3)
                    {

                        <h1>KONTÖR YÜKLEME TAMAMLAMA</h1>
                        <div class="table-responsive">
                            <table class="table table-dashboard table-striped table-hover">
                                <tr>
                                    <th>İŞLEM</th>
                                    <th>SERI</th>
                                    <th>MAC</th>
                                    <th>CARD</th>
                                    <th style="text-align:right;">FKREDİ</th>
                                    <th style="text-align:right;">SKREDİ</th>
                                    <th style="text-align:right;">KREDİ</th>
                                    <th>AÇIKLAMA</th>
                                    <th>ZAMAN</th>
                                    <th>DURUM</th>
                                </tr>

                                <tr>
                                    <td style="font-weight:500;"><a href="@($"/CardAction/Index/{Model.TicketSale.ID}")" class="btn btn-light" style="font-weight: 500; color: darkblue !important;">Kart Yükleme </a></td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td style="font-weight:500; text-align:right;"></td>
                                    <td style="font-weight:500; text-align:right;"></td>
                                    <td style="font-weight:500; text-align:right;"></td>
                                    <td style="text-align:left;"></td>
                                    <td></td>
                                    <td style="font-weight:500;"><a href="@($"/CardAction/Index/{Model.TicketSale.ID}")" class="btn btn-light" style="font-weight: 500; color: darkblue !important;">Bekliyor</a></td>
                                </tr>

                            </table>

                        </div>
                    }



                </div>
            </div><!-- content -->
            <div class="fixed-footer">
                <div class="container">
                    <div class="footer-up">
                        <div class="clean clean-2">
                            <a href="/Sales">
                                <svg xmlns="http://www.w3.org/2000/svg" width="87.52" height="65.64" viewBox="0 0 87.52 65.64">
                                    <path d="M80.227,3h-54.7a6.864,6.864,0,0,0-5.8,3.209L0,35.82,19.728,65.394a6.9,6.9,0,0,0,5.8,3.246h54.7a7.315,7.315,0,0,0,7.293-7.293V10.293A7.315,7.315,0,0,0,80.227,3Zm0,58.347H25.782L8.752,35.82,25.745,10.293H80.227ZM37.962,54.053,51.053,40.962,64.145,54.053l5.142-5.142L56.2,35.82,69.287,22.728l-5.142-5.142L51.053,30.678,37.962,17.587,32.82,22.728,45.912,35.82,32.82,48.912Z" transform="translate(0 -3)" fill="currentColor" />
                                </svg>
                                <!-- clean -->
                                <span>GERİ</span>
                            </a>
                        </div>
                        @if (Model.TicketSale.PosStatusID == 4)
                        {
                            <div class="ingenico-btn">
                                <a href="/Transaction/Retry/@(Model.TicketSale.ID)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="271.72" height="271.72" viewBox="0 0 271.72 271.72">
                                        <path d="M87.252,9H19.322A11.355,11.355,0,0,0,8,20.322v135.86A11.355,11.355,0,0,0,19.322,167.5h67.93a11.355,11.355,0,0,0,11.322-11.322V20.322A11.355,11.355,0,0,0,87.252,9ZM75.93,144.86H30.643V31.643H75.93Z" transform="translate(82.573 92.895)" fill="currentColor" />
                                        <ellipse cx="11" cy="11.5" rx="11" ry="11.5" transform="translate(124.687 136.687)" fill="currentColor" />
                                        <path d="M36.26,68.5,52.224,84.46a56.853,56.853,0,0,1,80.157,0L148.345,68.5a79.265,79.265,0,0,0-112.084,0ZM92.3,0A124.147,124.147,0,0,0,4.22,36.456L20.184,52.419a101.952,101.952,0,0,1,144.125.113l15.964-15.964A123.313,123.313,0,0,0,92.3,0Z" transform="translate(43.557)" fill="currentColor" />
                                    </svg>
                                    <span>TEKRAR DENE</span>
                                </a>
                            </div>
                        }
                        else if (Model.TicketSale.PosStatusID < 3)
                        {
                            <div class="ingenico-btn">
                                <a href="/Transaction/Index/@(Model.TicketSale.ID)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="271.72" height="271.72" viewBox="0 0 271.72 271.72">
                                        <path d="M87.252,9H19.322A11.355,11.355,0,0,0,8,20.322v135.86A11.355,11.355,0,0,0,19.322,167.5h67.93a11.355,11.355,0,0,0,11.322-11.322V20.322A11.355,11.355,0,0,0,87.252,9ZM75.93,144.86H30.643V31.643H75.93Z" transform="translate(82.573 92.895)" fill="currentColor" />
                                        <ellipse cx="11" cy="11.5" rx="11" ry="11.5" transform="translate(124.687 136.687)" fill="currentColor" />
                                        <path d="M36.26,68.5,52.224,84.46a56.853,56.853,0,0,1,80.157,0L148.345,68.5a79.265,79.265,0,0,0-112.084,0ZM92.3,0A124.147,124.147,0,0,0,4.22,36.456L20.184,52.419a101.952,101.952,0,0,1,144.125.113l15.964-15.964A123.313,123.313,0,0,0,92.3,0Z" transform="translate(43.557)" fill="currentColor" />
                                    </svg>
                                    <span>OKC POS</span>
                                </a>
                            </div>
                        }

                        <div class="payment payment-2">
                            @if (Model.PaymentAmount > Model.RefundedAmount)
                            {
                                <a href="/Sales/Refund/@(Model.TicketSale.ID)">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z" /></svg>
                                    <!-- payment -->
                                    <span>İADE ET</span>
                                </a>

                            }
                            else
                            {
                                <!--<a href="/Sales/Refund/@(Model.TicketSale.ID)">
                                    <svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><path fill="currentColor" d="M16,5l-1.42,1.42l-1.59-1.59V16h-1.98V4.83L9.42,6.42L8,5l4-4L16,5z M20,10v11c0,1.1-0.9,2-2,2H6c-1.11,0-2-0.9-2-2V10 c0-1.11,0.89-2,2-2h3v2H6v11h12V10h-3V8h3C19.1,8,20,8.89,20,10z" /></svg>-->
                                <!-- payment -->
                                <!--<span>İADE ET</span>
                                </a>-->
                            }


                            </div>
                        </div>
                    </div>
                </div><!-- fixed-footer -->

            </div>
        </div><!-- main -->
        <script src="/assets/js/jquery-3.5.1.min.js"></script>
        <script src="/assets/js/global.js"></script>
        <script>
            $(function () {
                const open = 'open';
                const $menu = $('.header .menu');
                const $listBtn = $('.bot-list-btn');

                $menu.on('click', function () {
                    let $this = $(this);
                    if (($this).hasClass(open)) {
                        $this.removeClass(open);
                        $('.side-menu,.side-menu-overlay').removeClass(open);
                    } else {
                        $this.addClass(open);
                        $('.side-menu,.side-menu-overlay').addClass(open);
                    }
                });
                $('.side-menu-overlay').on('click', function () {
                    $menu.removeClass(open);
                    $('.side-menu,.side-menu-overlay').removeClass(open);
                });

                $listBtn.on('click', function () {
                    let $this = $(this);
                    if ($this.hasClass(open)) {
                        $this.removeClass(open);
                        $('.fixed-footer-overlay').removeClass(open);
                        $('.footer-basket').stop().slideUp();
                    } else {
                        $this.addClass(open);
                        $('.fixed-footer-overlay').addClass(open);
                        $('.footer-basket').stop().slideDown();
                    }
                });
                $('.fixed-footer-overlay').on('click', function () {
                    $listBtn.removeClass(open);
                    $('.fixed-footer-overlay').removeClass(open);
                    $('.footer-basket').stop().slideUp();
                });
                $(document).ready(function () {
                    $('.piece-options .minus').click(function () {
                        var $input = $(this).parent().find('input');
                        var count = parseInt($input.val()) - 1;
                        count = count < 1 ? 1 : count;
                        $input.val(count);
                        $input.change();
                        return false;
                    });
                    $('.piece-options .plus').click(function () {
                        var $input = $(this).parent().find('input');
                        $input.val(parseInt($input.val()) + 1);
                        $input.change();
                        return false;
                    });
                });
            });</script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>

        <script type="text/javascript">
        // Default Configuration
        $(document).ready(function () {
            toastr.options = {
                'closeButton': true,
                'debug': false,
                'newestOnTop': false,
                'progressBar': false,
                'positionClass': 'toast-top-center',
                'preventDuplicates': false,
                'showDuration': '1000',
                'hideDuration': '1000',
                'timeOut': '5000',
                'extendedTimeOut': '1000',
                'showEasing': 'swing',
                'hideEasing': 'linear',
                'showMethod': 'fadeIn',
                'hideMethod': 'fadeOut',
            }

            @if (Model.Result != null && !string.IsNullOrEmpty(Model.Result.Message))
            {
                @(Html.Raw( $"toastr.info('{Model.Result.Message}')" ));
            }
        });

        </script>
    </body>
</html>